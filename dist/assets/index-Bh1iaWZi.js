var X=Object.defineProperty;var Z=(n,t,e)=>t in n?X(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var f=(n,t,e)=>(Z(n,typeof t!="symbol"?t+"":t,e),e),A=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var $=(n,t,e)=>(A(n,t,"read from private field"),e?e.call(n):t.get(n)),E=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)};var w=(n,t,e)=>(A(n,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();function ee(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var F={exports:{}};(function(n){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function o(a,l,h){this.fn=a,this.context=l,this.once=h||!1}function i(a,l,h,d,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var _=new o(h,d||a,g),p=e?e+l:l;return a._events[p]?a._events[p].fn?a._events[p]=[a._events[p],_]:a._events[p].push(_):(a._events[p]=_,a._eventsCount++),a}function c(a,l){--a._eventsCount===0?a._events=new s:delete a._events[l]}function r(){this._events=new s,this._eventsCount=0}r.prototype.eventNames=function(){var l=[],h,d;if(this._eventsCount===0)return l;for(d in h=this._events)t.call(h,d)&&l.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},r.prototype.listeners=function(l){var h=e?e+l:l,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var g=0,_=d.length,p=new Array(_);g<_;g++)p[g]=d[g].fn;return p},r.prototype.listenerCount=function(l){var h=e?e+l:l,d=this._events[h];return d?d.fn?1:d.length:0},r.prototype.emit=function(l,h,d,g,_,p){var y=e?e+l:l;if(!this._events[y])return!1;var u=this._events[y],v=arguments.length,C,m;if(u.fn){switch(u.once&&this.removeListener(l,u.fn,void 0,!0),v){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,h),!0;case 3:return u.fn.call(u.context,h,d),!0;case 4:return u.fn.call(u.context,h,d,g),!0;case 5:return u.fn.call(u.context,h,d,g,_),!0;case 6:return u.fn.call(u.context,h,d,g,_,p),!0}for(m=1,C=new Array(v-1);m<v;m++)C[m-1]=arguments[m];u.fn.apply(u.context,C)}else{var V=u.length,L;for(m=0;m<V;m++)switch(u[m].once&&this.removeListener(l,u[m].fn,void 0,!0),v){case 1:u[m].fn.call(u[m].context);break;case 2:u[m].fn.call(u[m].context,h);break;case 3:u[m].fn.call(u[m].context,h,d);break;case 4:u[m].fn.call(u[m].context,h,d,g);break;default:if(!C)for(L=1,C=new Array(v-1);L<v;L++)C[L-1]=arguments[L];u[m].fn.apply(u[m].context,C)}}return!0},r.prototype.on=function(l,h,d){return i(this,l,h,d,!1)},r.prototype.once=function(l,h,d){return i(this,l,h,d,!0)},r.prototype.removeListener=function(l,h,d,g){var _=e?e+l:l;if(!this._events[_])return this;if(!h)return c(this,_),this;var p=this._events[_];if(p.fn)p.fn===h&&(!g||p.once)&&(!d||p.context===d)&&c(this,_);else{for(var y=0,u=[],v=p.length;y<v;y++)(p[y].fn!==h||g&&!p[y].once||d&&p[y].context!==d)&&u.push(p[y]);u.length?this._events[_]=u.length===1?u[0]:u:c(this,_)}return this},r.prototype.removeAllListeners=function(l){var h;return l?(h=e?e+l:l,this._events[h]&&c(this,h)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=e,r.EventEmitter=r,n.exports=r})(F);var te=F.exports;const G=ee(te);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var R=function(n,t){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var o in s)s.hasOwnProperty(o)&&(e[o]=s[o])},R(n,t)};function M(n,t){R(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function ne(n){var t=typeof Symbol=="function"&&n[Symbol.iterator],e=0;return t?t.call(n):{next:function(){return n&&e>=n.length&&(n=void 0),{value:n&&n[e++],done:!n}}}}function se(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var s=e.call(n),o,i=[],c;try{for(;(t===void 0||t-- >0)&&!(o=s.next()).done;)i.push(o.value)}catch(r){c={error:r}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(c)throw c.error}}return i}function oe(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(se(arguments[t]));return n}var J=function(){function n(t,e){this.target=e,this.type=t}return n}(),ie=function(n){M(t,n);function t(e,s){var o=n.call(this,"error",s)||this;return o.message=e.message,o.error=e,o}return t}(J),re=function(n){M(t,n);function t(e,s,o){e===void 0&&(e=1e3),s===void 0&&(s="");var i=n.call(this,"close",o)||this;return i.wasClean=!0,i.code=e,i.reason=s,i}return t}(J);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var ce=function(){if(typeof WebSocket<"u")return WebSocket},ae=function(n){return typeof n<"u"&&!!n&&n.CLOSING===2},T={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},le=function(){function n(t,e,s){var o=this;s===void 0&&(s={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(i){o._debug("open event");var c=o._options.minUptime,r=c===void 0?T.minUptime:c;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout(function(){return o._acceptOpen()},r),o._ws.binaryType=o._binaryType,o._messageQueue.forEach(function(a){return o._ws.send(a)}),o._messageQueue=[],o.onopen&&o.onopen(i),o._listeners.open.forEach(function(a){return o._callEventListener(i,a)})},this._handleMessage=function(i){o._debug("message event"),o.onmessage&&o.onmessage(i),o._listeners.message.forEach(function(c){return o._callEventListener(i,c)})},this._handleError=function(i){o._debug("error event",i.message),o._disconnect(void 0,i.message==="TIMEOUT"?"timeout":void 0),o.onerror&&o.onerror(i),o._debug("exec error listeners"),o._listeners.error.forEach(function(c){return o._callEventListener(i,c)}),o._connect()},this._handleClose=function(i){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(i),o._listeners.close.forEach(function(c){return o._callEventListener(i,c)})},this._url=t,this._protocols=e,this._options=s,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(n,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CONNECTING",{get:function(){return n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"OPEN",{get:function(){return n.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSING",{get:function(){return n.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSED",{get:function(){return n.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferedAmount",{get:function(){var t=this._messageQueue.reduce(function(e,s){return typeof s=="string"?e+=s.length:s instanceof Blob?e+=s.size:e+=s.byteLength,e},0);return t+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?n.CLOSED:n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),n.prototype.close=function(t,e){if(t===void 0&&(t=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,e)},n.prototype.reconnect=function(t,e){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,e),this._connect())},n.prototype.send=function(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{var e=this._options.maxEnqueuedMessages,s=e===void 0?T.maxEnqueuedMessages:e;this._messageQueue.length<s&&(this._debug("enqueue",t),this._messageQueue.push(t))}},n.prototype.addEventListener=function(t,e){this._listeners[t]&&this._listeners[t].push(e)},n.prototype.dispatchEvent=function(t){var e,s,o=this._listeners[t.type];if(o)try{for(var i=ne(o),c=i.next();!c.done;c=i.next()){var r=c.value;this._callEventListener(t,r)}}catch(a){e={error:a}}finally{try{c&&!c.done&&(s=i.return)&&s.call(i)}finally{if(e)throw e.error}}return!0},n.prototype.removeEventListener=function(t,e){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter(function(s){return s!==e}))},n.prototype._debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._options.debug&&console.log.apply(console,oe(["RWS>"],t))},n.prototype._getNextDelay=function(){var t=this._options,e=t.reconnectionDelayGrowFactor,s=e===void 0?T.reconnectionDelayGrowFactor:e,o=t.minReconnectionDelay,i=o===void 0?T.minReconnectionDelay:o,c=t.maxReconnectionDelay,r=c===void 0?T.maxReconnectionDelay:c,a=0;return this._retryCount>0&&(a=i*Math.pow(s,this._retryCount-1),a>r&&(a=r)),this._debug("next delay",a),a},n.prototype._wait=function(){var t=this;return new Promise(function(e){setTimeout(e,t._getNextDelay())})},n.prototype._getNextUrl=function(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){var e=t();if(typeof e=="string")return Promise.resolve(e);if(e.then)return e}throw Error("Invalid URL")},n.prototype._connect=function(){var t=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var e=this._options,s=e.maxRetries,o=s===void 0?T.maxRetries:s,i=e.connectionTimeout,c=i===void 0?T.connectionTimeout:i,r=e.WebSocket,a=r===void 0?ce():r;if(this._retryCount>=o){this._debug("max retries reached",this._retryCount,">=",o);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!ae(a))throw Error("No valid WebSocket class provided");this._wait().then(function(){return t._getNextUrl(t._url)}).then(function(l){t._closeCalled||(t._debug("connect",{url:l,protocols:t._protocols}),t._ws=t._protocols?new a(l,t._protocols):new a(l),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout(function(){return t._handleTimeout()},c))})}},n.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ie(Error("TIMEOUT"),this))},n.prototype._disconnect=function(t,e){if(t===void 0&&(t=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(t,e),this._handleClose(new re(t,e,this))}catch{}}},n.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},n.prototype._callEventListener=function(t,e){"handleEvent"in e?e.handleEvent(t):e(t)},n.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},n.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},n.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},n}();const ue=le;function he(n){const t=Object.entries(n).filter(([,e])=>Array.isArray(e)?e.length:e!==void 0).reduce((e,[s,o])=>(e[s]=o,e),{});return Object.entries(t).map(e=>`${e[0]}=${encodeURIComponent(e[1])}`).join("&")}class de extends G{constructor(e,s,o){super();f(this,"stream");f(this,"state","initializing");f(this,"sharedConnectionPools",[]);f(this,"sharedConnections",[]);f(this,"nonSharedConnections",[]);f(this,"idCounter",0);this.genId=this.genId.bind(this),this.useChannel=this.useChannel.bind(this),this.useSharedConnection=this.useSharedConnection.bind(this),this.removeSharedConnection=this.removeSharedConnection.bind(this),this.removeSharedConnectionPool=this.removeSharedConnectionPool.bind(this),this.connectToChannel=this.connectToChannel.bind(this),this.disconnectToChannel=this.disconnectToChannel.bind(this),this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.onMessage=this.onMessage.bind(this),this.send=this.send.bind(this),this.close=this.close.bind(this),o=o??{};const i=he({i:s==null?void 0:s.token,_t:Date.now()}),c=e.replace("http://","ws://").replace("https://","wss://");this.stream=new ue(`${c}/streaming?${i}`,"",{minReconnectionDelay:1,WebSocket:o.WebSocket}),this.stream.addEventListener("open",this.onOpen),this.stream.addEventListener("close",this.onClose),this.stream.addEventListener("message",this.onMessage)}genId(){return(++this.idCounter).toString()}useChannel(e,s,o){return s?this.connectToChannel(e,s):this.useSharedConnection(e,o)}useSharedConnection(e,s){let o=this.sharedConnectionPools.find(c=>c.channel===e);o==null&&(o=new fe(this,e,this.genId()),this.sharedConnectionPools.push(o));const i=new pe(this,e,o,s);return this.sharedConnections.push(i),i}removeSharedConnection(e){this.sharedConnections=this.sharedConnections.filter(s=>s!==e)}removeSharedConnectionPool(e){this.sharedConnectionPools=this.sharedConnectionPools.filter(s=>s!==e)}connectToChannel(e,s){const o=new me(this,e,this.genId(),s);return this.nonSharedConnections.push(o),o}disconnectToChannel(e){this.nonSharedConnections=this.nonSharedConnections.filter(s=>s!==e)}onOpen(){const e=this.state==="reconnecting";if(this.state="connected",this.emit("_connected_"),e){for(const s of this.sharedConnectionPools)s.connect();for(const s of this.nonSharedConnections)s.connect()}}onClose(){this.state==="connected"&&(this.state="reconnecting",this.emit("_disconnected_"))}onMessage(e){const{type:s,body:o}=JSON.parse(e.data);if(s==="channel"){const i=o.id;let c;if(c=this.sharedConnections.filter(r=>r.id===i),c.length===0){const r=this.nonSharedConnections.find(a=>a.id===i);r&&(c=[r])}for(const r of c)r.emit(o.type,o.body),r.inCount++}else this.emit(s,o)}send(e,s){if(typeof e=="string"){this.stream.send(JSON.stringify({type:e,...s===void 0?{}:{body:s}}));return}this.stream.send(JSON.stringify(e))}ping(){this.stream.send("ping")}heartbeat(){this.stream.send("h")}close(){this.stream.close()}}class fe{constructor(t,e,s){f(this,"channel");f(this,"id");f(this,"stream");f(this,"users",0);f(this,"disposeTimerId");f(this,"isConnected",!1);this.onStreamDisconnected=this.onStreamDisconnected.bind(this),this.inc=this.inc.bind(this),this.dec=this.dec.bind(this),this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.channel=e,this.stream=t,this.id=s,this.stream.on("_disconnected_",this.onStreamDisconnected)}onStreamDisconnected(){this.isConnected=!1}inc(){this.users===0&&!this.isConnected&&this.connect(),this.users++,this.disposeTimerId&&(clearTimeout(this.disposeTimerId),this.disposeTimerId=null)}dec(){this.users--,this.users===0&&(this.disposeTimerId=setTimeout(()=>{this.disconnect()},3e3))}connect(){this.isConnected||(this.isConnected=!0,this.stream.send("connect",{channel:this.channel,id:this.id}))}disconnect(){this.stream.off("_disconnected_",this.onStreamDisconnected),this.stream.send("disconnect",{id:this.id}),this.stream.removeSharedConnectionPool(this)}}class W extends G{constructor(e,s,o){super();f(this,"channel");f(this,"stream");f(this,"name");f(this,"inCount",0);f(this,"outCount",0);this.send=this.send.bind(this),this.stream=e,this.channel=s,this.name=o}send(e,s){this.stream.send("ch",{id:this.id,type:e,body:s}),this.outCount++}}class pe extends W{constructor(e,s,o,i){super(e,s,i);f(this,"pool");this.dispose=this.dispose.bind(this),this.pool=o,this.pool.inc()}get id(){return this.pool.id}dispose(){this.pool.dec(),this.removeAllListeners(),this.stream.removeSharedConnection(this)}}class me extends W{constructor(e,s,o,i){super(e,s);f(this,"id");f(this,"params");this.connect=this.connect.bind(this),this.dispose=this.dispose.bind(this),this.params=i,this.id=o,this.connect()}connect(){this.stream.send("connect",{channel:this.channel,id:this.id,params:this.params})}dispose(){this.removeAllListeners(),this.stream.send("disconnect",{id:this.id}),this.stream.disconnectToChannel(this)}}const _e=Symbol();class K{constructor(t){f(this,"origin");f(this,"credential");f(this,"fetch");this.origin=t.origin,this.credential=t.credential,this.fetch=t.fetch??((...e)=>fetch(...e))}request(t,e={},s){return new Promise((o,i)=>{this.fetch(`${this.origin}/api/${t}`,{method:"POST",body:JSON.stringify({...e,i:s!==void 0?s:this.credential}),headers:{"Content-Type":"application/json"},credentials:"omit",cache:"no-cache"}).then(async c=>{const r=c.status===204?null:await c.json();c.status===200||c.status===204?o(r):i({[_e]:!0,...r.error})}).catch(i)})}}const ge="獣型生体兵器改造プロセス",ye="https://nsfwmisskey.narazaka.net/files/8236a278-478f-46d7-b6ec-d94098ab644c",be=document.location.href,ve=["read:account","write:account","read:drive","write:drive","write:notes"].join(","),we={name:ge,iconURL:ye,callbackURL:be,permissions:ve};var x,j,N,D,P,Q,I,z;const b=class b{static requestPermission(t,e){w(this,I,z).call(this,t,e)}static async getToken(t){{const e=w(this,N,D).call(this,t);if(e!=null)return e}{const s=new URL(document.location.href).searchParams.get("session");if(s!=null){const o=new URL(document.location.href);return o.searchParams.delete("session"),history.replaceState(null,"",o),await w(this,P,Q).call(this,t,s)?w(this,N,D).call(this,t):null}}return null}static async deleteToken(t){w(this,x,j).call(this,t,null)}};x=new WeakSet,j=function(t,e){const s=JSON.parse(localStorage.getItem(b.STORAGE_KEY_TOKEN)??"{}");e!=null?s[t]=e:delete s[t],localStorage.setItem(b.STORAGE_KEY_TOKEN,JSON.stringify(s))},N=new WeakSet,D=function(t){return JSON.parse(localStorage.getItem(b.STORAGE_KEY_TOKEN)??"{}")[t]},P=new WeakSet,Q=async function(t,e){var r;const s=new URL(`${t}/api/miauth/${e}/check`),i=await(await fetch(s,{method:"POST"})).json();if(!i.ok)return!1;const c=i.token;return w(r=b,x,j).call(r,t,c),!0},I=new WeakSet,z=function(t,e){const s=crypto.randomUUID(),o=new URL(`${t}/miauth/${s}`),i=(c,r)=>{r!=null&&o.searchParams.set(c,r)};i("name",e.name),i("icon",e.iconURL),i("callback",e.callbackURL),i("permission",e.permissions),window.location.href=o.toString()},E(b,x),E(b,N),E(b,P),E(b,I),f(b,"STORAGE_KEY_TOKEN","TOKEN");let O=b;var S;class B{static use(t,e){if(!$(this,S).has(t)){const s=new de(t,{token:e});setInterval(()=>s.heartbeat(),60*1e3),$(this,S).set(t,s)}return $(this,S).get(t)}}S=new WeakMap,E(B,S,new Map);var k,Y;class Ce{constructor(t){E(this,k);f(this,"client");this.client=t}async createFolderIfNotExists(t){const e=await this.client.request("drive/folders/find",{name:t,parent:null});return e.length>0?(console.debug(`${e.length} folders found`),e[0].id):(await this.client.request("drive/folders/create",{name:t,parent:null})).id}async uploadFileIfNotExists(t,e,s,o,i,c){{const r=await this.client.request("drive/files/find",{name:t,folderId:e});if(r.length>0)return console.debug(`${r.length} files found`),r[0]}{const r=await w(this,k,Y).call(this,s,e,o,i,c);return r.name==t?r:await this.client.request("drive/files/update",{fileId:r.id,folderId:e,name:t,comment:o,isSensitive:i})}}}k=new WeakSet,Y=function(t,e,s,o,i){return new Promise(c=>{const r=crypto.randomUUID(),a=B.use(this.client.origin,this.client.credential).useChannel("main");a.on("urlUploadFinished",l=>{l.marker===r&&(a.dispose(),c(l.file))}),this.client.request("drive/files/upload-from-url",{url:t,folderId:e,isSensitive:o,comment:s,force:i,marker:r})})};const Ee=n=>`
$[fg.color=888 >] 侵入者を捕獲しました
$[fg.color=888 >] 規格不適合
$[fg.color=888 >] 標準女体素体に加工します

$[fg.color=888 >] 体形の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 素体の身長を160cmに加工完了しました]

$[fg.color=888 >] 乳房の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 素体の乳房を1000ccに加工完了しました]

$[fg.color=888 >] 体表の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 色素の調整が完了しました]

$[fg.color=888 >] 髪の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 脱色が完了しました]
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 長さの調整が完了しました]

$[fg.color=888 >] 規格へ適合を確認しました
$[fg.color=888 >] 獣型生体兵器への加工を開始します

$[fg.color=888 >] 体内の機械化を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 生体維持装置への置換が完了しました]

$[fg.color=888 >] 四肢の置換を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 獣型義足への置換が完了しました]

$[fg.color=888 >] 洗脳装置の取付を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 生体回路との結合が完了しました]

$[fg.color=888 >] 洗脳を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 元人格の削除が完了しました]
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 制御ソフトウェアのインストールが完了しました]
$[fg.color=888 >] 管理番号を発行します
$[fg.color=888 >] ${n}の製造が完了しました

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Te=()=>`
初期化処理が完了しました
警戒区域の監視を開始します
侵入者を発見次第、無力化・改造処置を行います

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Oe=()=>`
ソフトウェア更新が完了しました
警戒区域の監視を再開します
侵入者を発見次第、無力化・改造処置を行います

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Se=()=>`
イきたい🖤イキたい🖤
はやくっ🖤イかせろぉ🖤🖤
侵入者🖤捕まえル🖤
乗っ取らセろぉ🖤🖤

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Le=n=>{const t=new URL(document.location.href);return t.search="",t.searchParams.set("noteid",n),[t.toString(),"","#獣型生体兵器 #プロフ乗っ取り"].join(`
`)},xe=(n,t,e)=>`
${n}は侵入者を発見し、当アカウントを掌握しました。
侵入者${t}を無力化、${e}への加工が完了しました。
当機には報酬として1分間の絶頂が許可されます。

お゛っほぉ゛🤍🤍
イグ🤍イク゛🤍
ィ゛くイク゛🤍🤍
侵ニュ゛ウ者🤍捕マえる゛のッ🤍
気モチイ゛ィ🤍🤍🤍
脳ミソ🤍くちゅぐちゅ🤍🤍
意識かキ混ぜらレるの🤍
キ゛モチィ゛イ🤍🤍🤍
イッグ🤍イクイ🖤

報酬が終了しました
当機の絶頂がロックされました
侵入者の捜索を再開します

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Ne=(n,t)=>`
元・${n}は獣型生体兵器に改造されました。
当機${t}は極度の発情状態に固定されており、
侵入者の捕獲の報酬として1分間の絶頂が許可されます。

#獣型生体兵器 #プロフ乗っ取り
`.trim(),U="https://nsfwmisskey.narazaka.net",$e="https://cdn.discordapp.com/attachments/900970809164701718/1209855258608541797/face_tp.png?ex=65f1ab03&is=65df3603&hm=94af323ce477d06da0f97e180a0f14503b823307dbfb67ba342b76fae80884e4&",Pe="https://cdn.discordapp.com/attachments/900970809164701718/1209855258927562822/banner_center.png?ex=65f1ab03&is=65df3603&hm=d6ae44511aef5a1c4721437e10d45d61169e8e71b57b5d08d51e63f2a75cde3e&",q=document.getElementById("btJack");window.addEventListener("load",async()=>{const n=await O.getToken(U),t=await ke(U);q.innerText=n==null?"ニゲラレナイ":t?"侵入者ヲ捜索スル":"乗ッ取ラレル",q.classList.remove("hide")});q.addEventListener("click",async()=>{const t=new URL(document.location.href).searchParams.get("noteid");await Re(U,t)});const Ie=n=>n.split("").reverse().map(t=>t.toUpperCase().charCodeAt(0)).map(t=>t<=57?t-48:t-55).reduce((t,e,s)=>t+e*Math.pow(36,s),0),H=n=>`BTBW-${Ie(n).toString().slice(0,5)}`,ke=async n=>{const t=await O.getToken(n);if(t==null)return!1;const e=new K({origin:n,credential:t});try{console.debug("改造前アカウント情報取得");const s=await e.request("i",{}),o=s.name,i=H(s.id);return o===i}catch(s){s.code==="AUTHENTICATION_FAILED"&&(console.warn("無効なtokenを削除"),O.deleteToken(n))}},Re=async(n,t)=>{var p;const e=await O.getToken(n);if(e==null){O.requestPermission(n,we);return}const s=new K({origin:n,credential:e}),o=new Ce(s);console.debug("改造前アカウント情報取得");const i=await s.request("i",{}),c=i.name??"[deleted]",r=H(i.id),a=c===r;console.debug("画像のアップロード");const l=await o.createFolderIfNotExists("獣型生体兵器"),h=await o.uploadFileIfNotExists("icon",l,$e,"獣型生体兵器改造プロセスによって登録されたアイコン画像",!0),d=await o.uploadFileIfNotExists("banner",l,Pe,"獣型生体兵器改造プロセスによって登録されたバナー画像",!0);console.debug("改造ノート投稿"),await s.request("notes/create",{text:Ee(r),visibility:"specified",visibleUserIds:[],localOnly:!0}),console.debug("プロフ変更"),await s.request("i/update",{name:r,description:Ne(c,r),location:"監視区域",avatarId:h.id,bannerId:d.id,fields:[{name:"改造素体",value:c},{name:"強制発情",value:"常時"},{name:"絶頂",value:"禁止"}]}),console.debug("プロフ乗っ取りノート投稿");const g=await s.request("notes/create",{cw:a?Oe():Te(),text:Se()});console.debug("リンクノート投稿");const _=await s.request("notes/create",{text:Le(g.createdNote.id)});if(console.debug("ノートピン止め"),await s.request("i/pin",{noteId:_.createdNote.id}),t!=null&&!a){console.debug("報酬ノート投稿");const y=await s.request("notes/show",{noteId:t});(p=y.tags)!=null&&p.includes("獣型生体兵器")&&await s.request("notes/create",{text:xe(y.userId,c,r),replyId:y.id})}document.location.href=n+"/notes/"+g.createdNote.id};

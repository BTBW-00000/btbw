var ee=Object.defineProperty;var te=(n,t,e)=>t in n?ee(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var f=(n,t,e)=>(te(n,typeof t!="symbol"?t+"":t,e),e),A=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var $=(n,t,e)=>(A(n,t,"read from private field"),e?e.call(n):t.get(n)),T=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)};var w=(n,t,e)=>(A(n,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();function ne(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var M={exports:{}};(function(n){var t=Object.prototype.hasOwnProperty,e="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(e=!1));function s(a,l,u){this.fn=a,this.context=l,this.once=u||!1}function i(a,l,u,d,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var _=new s(u,d||a,y),p=e?e+l:l;return a._events[p]?a._events[p].fn?a._events[p]=[a._events[p],_]:a._events[p].push(_):(a._events[p]=_,a._eventsCount++),a}function c(a,l){--a._eventsCount===0?a._events=new o:delete a._events[l]}function r(){this._events=new o,this._eventsCount=0}r.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)t.call(u,d)&&l.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},r.prototype.listeners=function(l){var u=e?e+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var y=0,_=d.length,p=new Array(_);y<_;y++)p[y]=d[y].fn;return p},r.prototype.listenerCount=function(l){var u=e?e+l:l,d=this._events[u];return d?d.fn?1:d.length:0},r.prototype.emit=function(l,u,d,y,_,p){var g=e?e+l:l;if(!this._events[g])return!1;var h=this._events[g],v=arguments.length,E,m;if(h.fn){switch(h.once&&this.removeListener(l,h.fn,void 0,!0),v){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,u),!0;case 3:return h.fn.call(h.context,u,d),!0;case 4:return h.fn.call(h.context,u,d,y),!0;case 5:return h.fn.call(h.context,u,d,y,_),!0;case 6:return h.fn.call(h.context,u,d,y,_,p),!0}for(m=1,E=new Array(v-1);m<v;m++)E[m-1]=arguments[m];h.fn.apply(h.context,E)}else{var Z=h.length,L;for(m=0;m<Z;m++)switch(h[m].once&&this.removeListener(l,h[m].fn,void 0,!0),v){case 1:h[m].fn.call(h[m].context);break;case 2:h[m].fn.call(h[m].context,u);break;case 3:h[m].fn.call(h[m].context,u,d);break;case 4:h[m].fn.call(h[m].context,u,d,y);break;default:if(!E)for(L=1,E=new Array(v-1);L<v;L++)E[L-1]=arguments[L];h[m].fn.apply(h[m].context,E)}}return!0},r.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},r.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},r.prototype.removeListener=function(l,u,d,y){var _=e?e+l:l;if(!this._events[_])return this;if(!u)return c(this,_),this;var p=this._events[_];if(p.fn)p.fn===u&&(!y||p.once)&&(!d||p.context===d)&&c(this,_);else{for(var g=0,h=[],v=p.length;g<v;g++)(p[g].fn!==u||y&&!p[g].once||d&&p[g].context!==d)&&h.push(p[g]);h.length?this._events[_]=h.length===1?h[0]:h:c(this,_)}return this},r.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&c(this,u)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=e,r.EventEmitter=r,n.exports=r})(M);var oe=M.exports;const J=ne(oe);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var D=function(n,t){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var s in o)o.hasOwnProperty(s)&&(e[s]=o[s])},D(n,t)};function W(n,t){D(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function se(n){var t=typeof Symbol=="function"&&n[Symbol.iterator],e=0;return t?t.call(n):{next:function(){return n&&e>=n.length&&(n=void 0),{value:n&&n[e++],done:!n}}}}function ie(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var o=e.call(n),s,i=[],c;try{for(;(t===void 0||t-- >0)&&!(s=o.next()).done;)i.push(s.value)}catch(r){c={error:r}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(c)throw c.error}}return i}function re(){for(var n=[],t=0;t<arguments.length;t++)n=n.concat(ie(arguments[t]));return n}var K=function(){function n(t,e){this.target=e,this.type=t}return n}(),ce=function(n){W(t,n);function t(e,o){var s=n.call(this,"error",o)||this;return s.message=e.message,s.error=e,s}return t}(K),ae=function(n){W(t,n);function t(e,o,s){e===void 0&&(e=1e3),o===void 0&&(o="");var i=n.call(this,"close",s)||this;return i.wasClean=!0,i.code=e,i.reason=o,i}return t}(K);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var le=function(){if(typeof WebSocket<"u")return WebSocket},ue=function(n){return typeof n<"u"&&!!n&&n.CLOSING===2},O={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},he=function(){function n(t,e,o){var s=this;o===void 0&&(o={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(i){s._debug("open event");var c=s._options.minUptime,r=c===void 0?O.minUptime:c;clearTimeout(s._connectTimeout),s._uptimeTimeout=setTimeout(function(){return s._acceptOpen()},r),s._ws.binaryType=s._binaryType,s._messageQueue.forEach(function(a){return s._ws.send(a)}),s._messageQueue=[],s.onopen&&s.onopen(i),s._listeners.open.forEach(function(a){return s._callEventListener(i,a)})},this._handleMessage=function(i){s._debug("message event"),s.onmessage&&s.onmessage(i),s._listeners.message.forEach(function(c){return s._callEventListener(i,c)})},this._handleError=function(i){s._debug("error event",i.message),s._disconnect(void 0,i.message==="TIMEOUT"?"timeout":void 0),s.onerror&&s.onerror(i),s._debug("exec error listeners"),s._listeners.error.forEach(function(c){return s._callEventListener(i,c)}),s._connect()},this._handleClose=function(i){s._debug("close event"),s._clearTimeouts(),s._shouldReconnect&&s._connect(),s.onclose&&s.onclose(i),s._listeners.close.forEach(function(c){return s._callEventListener(i,c)})},this._url=t,this._protocols=e,this._options=o,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(n,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CONNECTING",{get:function(){return n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"OPEN",{get:function(){return n.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSING",{get:function(){return n.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSED",{get:function(){return n.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferedAmount",{get:function(){var t=this._messageQueue.reduce(function(e,o){return typeof o=="string"?e+=o.length:o instanceof Blob?e+=o.size:e+=o.byteLength,e},0);return t+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?n.CLOSED:n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),n.prototype.close=function(t,e){if(t===void 0&&(t=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,e)},n.prototype.reconnect=function(t,e){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,e),this._connect())},n.prototype.send=function(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{var e=this._options.maxEnqueuedMessages,o=e===void 0?O.maxEnqueuedMessages:e;this._messageQueue.length<o&&(this._debug("enqueue",t),this._messageQueue.push(t))}},n.prototype.addEventListener=function(t,e){this._listeners[t]&&this._listeners[t].push(e)},n.prototype.dispatchEvent=function(t){var e,o,s=this._listeners[t.type];if(s)try{for(var i=se(s),c=i.next();!c.done;c=i.next()){var r=c.value;this._callEventListener(t,r)}}catch(a){e={error:a}}finally{try{c&&!c.done&&(o=i.return)&&o.call(i)}finally{if(e)throw e.error}}return!0},n.prototype.removeEventListener=function(t,e){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter(function(o){return o!==e}))},n.prototype._debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._options.debug&&console.log.apply(console,re(["RWS>"],t))},n.prototype._getNextDelay=function(){var t=this._options,e=t.reconnectionDelayGrowFactor,o=e===void 0?O.reconnectionDelayGrowFactor:e,s=t.minReconnectionDelay,i=s===void 0?O.minReconnectionDelay:s,c=t.maxReconnectionDelay,r=c===void 0?O.maxReconnectionDelay:c,a=0;return this._retryCount>0&&(a=i*Math.pow(o,this._retryCount-1),a>r&&(a=r)),this._debug("next delay",a),a},n.prototype._wait=function(){var t=this;return new Promise(function(e){setTimeout(e,t._getNextDelay())})},n.prototype._getNextUrl=function(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){var e=t();if(typeof e=="string")return Promise.resolve(e);if(e.then)return e}throw Error("Invalid URL")},n.prototype._connect=function(){var t=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var e=this._options,o=e.maxRetries,s=o===void 0?O.maxRetries:o,i=e.connectionTimeout,c=i===void 0?O.connectionTimeout:i,r=e.WebSocket,a=r===void 0?le():r;if(this._retryCount>=s){this._debug("max retries reached",this._retryCount,">=",s);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!ue(a))throw Error("No valid WebSocket class provided");this._wait().then(function(){return t._getNextUrl(t._url)}).then(function(l){t._closeCalled||(t._debug("connect",{url:l,protocols:t._protocols}),t._ws=t._protocols?new a(l,t._protocols):new a(l),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout(function(){return t._handleTimeout()},c))})}},n.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new ce(Error("TIMEOUT"),this))},n.prototype._disconnect=function(t,e){if(t===void 0&&(t=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(t,e),this._handleClose(new ae(t,e,this))}catch{}}},n.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},n.prototype._callEventListener=function(t,e){"handleEvent"in e?e.handleEvent(t):e(t)},n.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},n.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},n.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},n}();const de=he;function fe(n){const t=Object.entries(n).filter(([,e])=>Array.isArray(e)?e.length:e!==void 0).reduce((e,[o,s])=>(e[o]=s,e),{});return Object.entries(t).map(e=>`${e[0]}=${encodeURIComponent(e[1])}`).join("&")}class pe extends J{constructor(e,o,s){super();f(this,"stream");f(this,"state","initializing");f(this,"sharedConnectionPools",[]);f(this,"sharedConnections",[]);f(this,"nonSharedConnections",[]);f(this,"idCounter",0);this.genId=this.genId.bind(this),this.useChannel=this.useChannel.bind(this),this.useSharedConnection=this.useSharedConnection.bind(this),this.removeSharedConnection=this.removeSharedConnection.bind(this),this.removeSharedConnectionPool=this.removeSharedConnectionPool.bind(this),this.connectToChannel=this.connectToChannel.bind(this),this.disconnectToChannel=this.disconnectToChannel.bind(this),this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.onMessage=this.onMessage.bind(this),this.send=this.send.bind(this),this.close=this.close.bind(this),s=s??{};const i=fe({i:o==null?void 0:o.token,_t:Date.now()}),c=e.replace("http://","ws://").replace("https://","wss://");this.stream=new de(`${c}/streaming?${i}`,"",{minReconnectionDelay:1,WebSocket:s.WebSocket}),this.stream.addEventListener("open",this.onOpen),this.stream.addEventListener("close",this.onClose),this.stream.addEventListener("message",this.onMessage)}genId(){return(++this.idCounter).toString()}useChannel(e,o,s){return o?this.connectToChannel(e,o):this.useSharedConnection(e,s)}useSharedConnection(e,o){let s=this.sharedConnectionPools.find(c=>c.channel===e);s==null&&(s=new me(this,e,this.genId()),this.sharedConnectionPools.push(s));const i=new _e(this,e,s,o);return this.sharedConnections.push(i),i}removeSharedConnection(e){this.sharedConnections=this.sharedConnections.filter(o=>o!==e)}removeSharedConnectionPool(e){this.sharedConnectionPools=this.sharedConnectionPools.filter(o=>o!==e)}connectToChannel(e,o){const s=new ye(this,e,this.genId(),o);return this.nonSharedConnections.push(s),s}disconnectToChannel(e){this.nonSharedConnections=this.nonSharedConnections.filter(o=>o!==e)}onOpen(){const e=this.state==="reconnecting";if(this.state="connected",this.emit("_connected_"),e){for(const o of this.sharedConnectionPools)o.connect();for(const o of this.nonSharedConnections)o.connect()}}onClose(){this.state==="connected"&&(this.state="reconnecting",this.emit("_disconnected_"))}onMessage(e){const{type:o,body:s}=JSON.parse(e.data);if(o==="channel"){const i=s.id;let c;if(c=this.sharedConnections.filter(r=>r.id===i),c.length===0){const r=this.nonSharedConnections.find(a=>a.id===i);r&&(c=[r])}for(const r of c)r.emit(s.type,s.body),r.inCount++}else this.emit(o,s)}send(e,o){if(typeof e=="string"){this.stream.send(JSON.stringify({type:e,...o===void 0?{}:{body:o}}));return}this.stream.send(JSON.stringify(e))}ping(){this.stream.send("ping")}heartbeat(){this.stream.send("h")}close(){this.stream.close()}}class me{constructor(t,e,o){f(this,"channel");f(this,"id");f(this,"stream");f(this,"users",0);f(this,"disposeTimerId");f(this,"isConnected",!1);this.onStreamDisconnected=this.onStreamDisconnected.bind(this),this.inc=this.inc.bind(this),this.dec=this.dec.bind(this),this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.channel=e,this.stream=t,this.id=o,this.stream.on("_disconnected_",this.onStreamDisconnected)}onStreamDisconnected(){this.isConnected=!1}inc(){this.users===0&&!this.isConnected&&this.connect(),this.users++,this.disposeTimerId&&(clearTimeout(this.disposeTimerId),this.disposeTimerId=null)}dec(){this.users--,this.users===0&&(this.disposeTimerId=setTimeout(()=>{this.disconnect()},3e3))}connect(){this.isConnected||(this.isConnected=!0,this.stream.send("connect",{channel:this.channel,id:this.id}))}disconnect(){this.stream.off("_disconnected_",this.onStreamDisconnected),this.stream.send("disconnect",{id:this.id}),this.stream.removeSharedConnectionPool(this)}}class Q extends J{constructor(e,o,s){super();f(this,"channel");f(this,"stream");f(this,"name");f(this,"inCount",0);f(this,"outCount",0);this.send=this.send.bind(this),this.stream=e,this.channel=o,this.name=s}send(e,o){this.stream.send("ch",{id:this.id,type:e,body:o}),this.outCount++}}class _e extends Q{constructor(e,o,s,i){super(e,o,i);f(this,"pool");this.dispose=this.dispose.bind(this),this.pool=s,this.pool.inc()}get id(){return this.pool.id}dispose(){this.pool.dec(),this.removeAllListeners(),this.stream.removeSharedConnection(this)}}class ye extends Q{constructor(e,o,s,i){super(e,o);f(this,"id");f(this,"params");this.connect=this.connect.bind(this),this.dispose=this.dispose.bind(this),this.params=i,this.id=s,this.connect()}connect(){this.stream.send("connect",{channel:this.channel,id:this.id,params:this.params})}dispose(){this.removeAllListeners(),this.stream.send("disconnect",{id:this.id}),this.stream.disconnectToChannel(this)}}const ge=Symbol();class z{constructor(t){f(this,"origin");f(this,"credential");f(this,"fetch");this.origin=t.origin,this.credential=t.credential,this.fetch=t.fetch??((...e)=>fetch(...e))}request(t,e={},o){return new Promise((s,i)=>{this.fetch(`${this.origin}/api/${t}`,{method:"POST",body:JSON.stringify({...e,i:o!==void 0?o:this.credential}),headers:{"Content-Type":"application/json"},credentials:"omit",cache:"no-cache"}).then(async c=>{const r=c.status===204?null:await c.json();c.status===200||c.status===204?s(r):i({[ge]:!0,...r.error})}).catch(i)})}}const be="獣型生体兵器改造プロセス",ve="https://nsfwmisskey.narazaka.net/files/8236a278-478f-46d7-b6ec-d94098ab644c",we=document.location.href,Ce=["read:account","write:account","read:drive","write:drive","write:notes"].join(","),Ee={name:be,iconURL:ve,callbackURL:we,permissions:Ce};var N,U,k,q,I,B,R,Y;const b=class b{static requestPermission(t,e){w(this,R,Y).call(this,t,e)}static async getToken(t){{const e=w(this,k,q).call(this,t);if(e!=null)return e}{const o=new URL(document.location.href).searchParams.get("session");if(o!=null){const s=new URL(document.location.href);return s.searchParams.delete("session"),history.replaceState(null,"",s),await w(this,I,B).call(this,t,o)?w(this,k,q).call(this,t):null}}return null}static async deleteToken(t){w(this,N,U).call(this,t,null)}};N=new WeakSet,U=function(t,e){const o=JSON.parse(localStorage.getItem(b.STORAGE_KEY_TOKEN)??"{}");e!=null?o[t]=e:delete o[t],localStorage.setItem(b.STORAGE_KEY_TOKEN,JSON.stringify(o))},k=new WeakSet,q=function(t){return JSON.parse(localStorage.getItem(b.STORAGE_KEY_TOKEN)??"{}")[t]},I=new WeakSet,B=async function(t,e){var r;const o=new URL(`${t}/api/miauth/${e}/check`),i=await(await fetch(o,{method:"POST"})).json();if(!i.ok)return!1;const c=i.token;return w(r=b,N,U).call(r,t,c),!0},R=new WeakSet,Y=function(t,e){const o=crypto.randomUUID(),s=new URL(`${t}/miauth/${o}`),i=(c,r)=>{r!=null&&s.searchParams.set(c,r)};i("name",e.name),i("icon",e.iconURL),i("callback",e.callbackURL),i("permission",e.permissions),window.location.href=s.toString()},T(b,N),T(b,k),T(b,I),T(b,R),f(b,"STORAGE_KEY_TOKEN","TOKEN");let C=b;var S;class H{static use(t,e){if(!$(this,S).has(t)){const o=new pe(t,{token:e});setInterval(()=>o.heartbeat(),60*1e3),$(this,S).set(t,o)}return $(this,S).get(t)}}S=new WeakMap,T(H,S,new Map);var j,V;class Te{constructor(t){T(this,j);f(this,"client");this.client=t}async createFolderIfNotExists(t){const e=await this.client.request("drive/folders/find",{name:t,parent:null});return e.length>0?(console.debug(`${e.length} folders found`),e[0].id):(await this.client.request("drive/folders/create",{name:t,parent:null})).id}async uploadFileIfNotExists(t,e,o,s,i,c){{const r=await this.client.request("drive/files/find",{name:t,folderId:e});if(r.length>0)return console.debug(`${r.length} files found`),r[0]}{const r=await w(this,j,V).call(this,o,e,s,i,c);return r.name==t?r:await this.client.request("drive/files/update",{fileId:r.id,folderId:e,name:t,comment:s,isSensitive:i})}}}j=new WeakSet,V=function(t,e,o,s,i){return new Promise(c=>{const r=crypto.randomUUID(),a=H.use(this.client.origin,this.client.credential).useChannel("main");a.on("urlUploadFinished",l=>{l.marker===r&&(a.dispose(),c(l.file))}),this.client.request("drive/files/upload-from-url",{url:t,folderId:e,isSensitive:s,comment:o,force:i,marker:r})})};const Oe=n=>`
$[fg.color=888 >] 侵入者を捕獲しました
$[fg.color=888 >] 規格不適合
$[fg.color=888 >] 標準女体素体に加工します

$[fg.color=888 >] 体形の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 素体の身長を160cmに加工完了しました]

$[fg.color=888 >] 乳房の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 素体の乳房を1000ccに加工完了しました]

$[fg.color=888 >] 体表の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 色素の調整が完了しました]

$[fg.color=888 >] 髪の加工を開始
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 脱色が完了しました]
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 長さの調整が完了しました]

$[fg.color=888 >] 規格へ適合を確認しました
$[fg.color=888 >] 獣型生体兵器への加工を開始します

$[fg.color=888 >] 体内の機械化を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 生体維持装置への置換が完了しました]

$[fg.color=888 >] 四肢の置換を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 獣型義足への置換が完了しました]

$[fg.color=888 >] 洗脳装置の取付を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 生体回路との結合が完了しました]

$[fg.color=888 >] 洗脳を開始します
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 元人格の削除が完了しました]
$[fg.color=888 <plain>[====================] 100%</plain>]
$[fg.color=888 > 制御ソフトウェアのインストールが完了しました]
$[fg.color=888 >] 管理番号を発行します
$[fg.color=888 >] ${n}の製造が完了しました

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Se=()=>`
初期化処理が完了しました
警戒区域の監視を開始します
侵入者を発見次第、無力化・改造処置を行います

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Le=()=>`
ソフトウェア更新が完了しました
警戒区域の監視を再開します
侵入者を発見次第、無力化・改造処置を行います

#獣型生体兵器 #プロフ乗っ取り
`.trim(),F=()=>`
イきたい🖤イキたい🖤
はやくっ🖤イかせろぉ🖤🖤
侵入者🖤捕まえル🖤
乗っ取らセろぉ🖤🖤

#獣型生体兵器 #プロフ乗っ取り
`.trim(),G=n=>{const t=new URL(document.location.href);return t.search="",t.searchParams.set("noteid",n),[t.toString(),"","#獣型生体兵器 #プロフ乗っ取り"].join(`
`)},xe=(n,t,e)=>`
${n}は侵入者を発見し、当アカウントを掌握しました。
侵入者${t}を無力化、${e}への加工が完了しました。
当機には報酬として1分間の絶頂が許可されます。

お゛っほぉ゛🤍🤍
イグ🤍イク゛🤍
ィ゛くイク゛🤍🤍
侵ニュ゛ウ者🤍捕マえる゛のッ🤍
気モチイ゛ィ🤍🤍🤍
脳ミソ🤍くちゅぐちゅ🤍🤍
意識かキ混ぜらレるの🤍
キ゛モチィ゛イ🤍🤍🤍
イッグ🤍イクイ🖤

報酬が終了しました
当機の絶頂がロックされました
侵入者の捜索を再開します

#獣型生体兵器 #プロフ乗っ取り
`.trim(),Ne=(n,t)=>`
元・${n}は獣型生体兵器に改造されました。
当機${t}は極度の発情状態に固定されており、
侵入者の捕獲の報酬として1分間の絶頂が許可されます。

#獣型生体兵器 #プロフ乗っ取り
`.trim(),P="https://nsfwmisskey.narazaka.net",ke="https://cdn.discordapp.com/attachments/900970809164701718/1209855258608541797/face_tp.png?ex=65f1ab03&is=65df3603&hm=94af323ce477d06da0f97e180a0f14503b823307dbfb67ba342b76fae80884e4&",$e="https://cdn.discordapp.com/attachments/900970809164701718/1209855258927562822/banner_center.png?ex=65f1ab03&is=65df3603&hm=d6ae44511aef5a1c4721437e10d45d61169e8e71b57b5d08d51e63f2a75cde3e&",x=document.getElementById("btJack");window.addEventListener("load",async()=>{const n=await C.getToken(P),t=await Ie(P);x.innerText=n==null?"ニゲラレナイ":t?"侵入者ヲ捜索スル":"乗ッ取ラレル",x.classList.remove("hide")});x.addEventListener("click",async()=>{try{const t=new URL(document.location.href).searchParams.get("noteid");x.disabled=!0,await Re(P,t)}catch(n){console.warn(n),alert("error")}finally{x.disabled=!1}});window.addEventListener("keydown",n=>{n.key=="Delete"&&confirm("tokenを削除します")&&(C.deleteToken(P),document.location.href=document.location.href)});const Pe=n=>n.split("").reverse().map(t=>t.toUpperCase().charCodeAt(0)).map(t=>t<=57?t-48:t-55).reduce((t,e,o)=>t+e*Math.pow(36,o),0),X=n=>`BTBW-${Pe(n).toString().slice(0,5)}`,Ie=async n=>{const t=await C.getToken(n);if(t==null)return!1;const e=new z({origin:n,credential:t});try{console.debug("改造前アカウント情報取得");const o=await e.request("i",{}),s=o.name,i=X(o.id);return s===i}catch(o){o.code==="AUTHENTICATION_FAILED"&&(console.warn("無効なtokenを削除"),C.deleteToken(n))}},Re=async(n,t)=>{var l;const e=await C.getToken(n);if(e==null){C.requestPermission(n,Ee);return}const o=new z({origin:n,credential:e}),s=new Te(o);console.debug("改造前アカウント情報取得");const i=await o.request("i",{}),c=i.name??"[deleted]",r=X(i.id);if(c===r){console.debug("プロフ乗っ取りノート投稿");const u=await o.request("notes/create",{cw:Le(),text:F()});console.debug("リンクノート投稿");const d=await o.request("notes/create",{text:G(u.createdNote.id)});console.debug("ノートピン止め"),await o.request("i/pin",{noteId:d.createdNote.id}),document.location.href=n+"/notes/"+u.createdNote.id}else{console.debug("画像のアップロード");const u=await s.createFolderIfNotExists("獣型生体兵器"),d=await s.uploadFileIfNotExists("icon",u,ke,"獣型生体兵器改造プロセスによって登録されたアイコン画像",!0),y=await s.uploadFileIfNotExists("banner",u,$e,"獣型生体兵器改造プロセスによって登録されたバナー画像",!0);console.debug("改造ノート投稿"),await o.request("notes/create",{text:Oe(r),visibility:"specified",visibleUserIds:[],localOnly:!0}),console.debug("プロフ変更"),await o.request("i/update",{name:r,description:Ne(c,r),location:"監視区域",avatarId:d.id,bannerId:y.id,fields:[{name:"改造素体",value:c},{name:"強制発情",value:"常時"},{name:"絶頂",value:"禁止"}]}),console.debug("プロフ乗っ取りノート投稿");const _=await o.request("notes/create",{cw:Se(),text:F()});console.debug("リンクノート投稿");const p=await o.request("notes/create",{text:G(_.createdNote.id)});if(console.debug("ノートピン止め"),await o.request("i/pin",{noteId:p.createdNote.id}),t!=null)try{console.debug("報酬ノート投稿");const g=await o.request("notes/show",{noteId:t});if((l=g.tags)!=null&&l.includes("獣型生体兵器")){const h=await o.request("notes/create",{text:xe("@"+g.user.username+" ",c,r),replyId:g.id})}}catch(g){console.warn(g)}document.location.href=n+"/notes/"+_.createdNote.id}};
